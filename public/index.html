<!doctype html>
<html lang="ja">
<meta charset="utf-8" />
<title>Push Test</title>
<h1>ğŸ“¨ Push ã‚µãƒ³ãƒ—ãƒ«</h1>
<button id="subscribe">é€šçŸ¥è¨±å¯ & ç™»éŒ²</button>
<script>
(async () => {
  if (!('serviceWorker' in navigator) || !('PushManager' in window)) {
    alert('ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ Push API æœªå¯¾å¿œã§ã™'); return;
  }
  const sw = await navigator.serviceWorker.register('/sw.js');
  document.getElementById('subscribe').onclick = async () => {
    // â˜…â†“â†“ å…¬é–‹éµã‚’è²¼ã‚Šä»˜ã‘
    const vapidKey = 'BAk09AyvYB0uZyjRCrByLpCGzRx_QUnKEr9dE7u4x_fv5Fn506bSInL7BMoZfl9JhGWxsYPl8tfOyG_NjDqq4hc';
    const sub = await sw.pushManager.subscribe({
      userVisibleOnly: true,
      applicationServerKey: Uint8Array.from(atob(vapidKey.replace(/_/g, '/').replace(/-/g, '+')), c => c.charCodeAt(0)),
    });
    await fetch('/save-sub', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(sub)});
    alert('ç™»éŒ²æˆåŠŸï¼ é€ä¿¡ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èµ°ã‚‰ã›ã¦ã¿ã¦ãã ã•ã„');
  };
})();
</script>
